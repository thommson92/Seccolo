<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seccolo</title>
    <link rel="icon" type="image/x-icon" href="seccolo.jpeg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="./style.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4 header-bar">Seccolo</h1>
        <div id="activityContainer" class="text-center mb-4">
            <!-- Aktuelle Aktivität wird hier angezeigt -->
        </div>
        <button id="nextButton" class="btn btn-primary w-100 mb-3">Weiter</button>
        <a id="backButton" href="index.html" class="btn btn-secondary w-100">Zurück zum Start</a>
        <footer>
            <span>Thomas Kellner &copy; 2024</span>
        </footer>
    </div>

    <script>
        // URL-Parameter auslesen und Spielernamen speichern
        const urlParams = new URLSearchParams(window.location.search);
        const players = [];
        urlParams.forEach((value, key) => {
            if (key.startsWith('player')) players.push(value);
        });

        if (players.length === 0) {
            document.body.innerHTML = '<div class="alert alert-danger">Keine Spieler übergeben!</div>';
            throw new Error('Keine Spieler übergeben');
        }

        // Set an Aktivitäten mit "X" als Platzhalter für Spielernamen
        const activities = [
            // Alle trinken
            { text: ['Alle trinken 2 Schlücke zur Auflockerung.'], playersNeeded: 0, multiStep: false, category: 'allDrink' },
            { text: ['Alle Frauen trinken 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allDrink' },
            { text: ['Alle Männer trinken 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allDrink' },
            { text: ['Alle Florians trinken 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allDrink' },
            { text: ['Alle Singles trinken 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allDrink' },
            { text: ['Alle Fussballer trinken 2 Schlücke. (Egal ob aktiv oder nicht)'], playersNeeded: 0, multiStep: false, category: 'allDrink' },
            { text: ['Alle Handballer trinken 2 Schlücke. (Egal ob aktiv oder nicht)'], playersNeeded: 0, multiStep: false, category: 'allDrink' },
            { text: ['Alle Singles trinken 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allDrink' },
            { text: ['Alle in einer Beziehung trinken 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allDrink' },
            { text: ['Alle mit Neujahrsvorsätzen trinken 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allDrink' },
            { text: ['Alle ohne Neujahrsvorsätze trinken 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allDrink' },
            { text: ['Alle mit roter Unterwäsche trinken 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allDrink' },
            { text: ['Alle mit schwarzen Socken trinken 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allDrink' },
            { text: ['Alle die eine Brille brauchen, trinken 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allDrink' },
            { text: ['Alle die eine Spielekonsole besitzen, trinken 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allDrink' },

            // Alle verteilen Schücke
            { text: ['Alle die gerade Wein trinken verteilen 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allVerteil' },
            { text: ['Alle die gerade Bier trinken verteilen 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allVerteil' },
            { text: ['Alle die gerade einen Longdrink trinken verteilen 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allVerteil' },
            { text: ['Alle die eine Brille tragen verteilen 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allVerteil' },
            { text: ['Alle mit weißer Unterwäsche verteilen 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allVerteil' },
            { text: ['Alle die eine Fliege oder Krawatte tragen verteilen 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allVerteil' },
            { text: ['Alle die ein Kleid tragen verteilen 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allVerteil' },
            { text: ['Der Gastgeber verteilt 5 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allVerteil' },
            { text: ['Der/die Älteste verteilt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allVerteil' },
            { text: ['Der/die Jüngste verteilt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'allVerteil' },

            // Einzelperson trinkt
            { text: ['X! Trinke ein ganzes Glas Wasser oder 2 Schlücke deines alkoholischen Getränks.'], playersNeeded: 1, multiStep: false, category: 'singleDrink' },
            { text: ['X! Exe das Glas eines beliebigen Mitspielers.'], playersNeeded: 1, multiStep: false, category: 'singleDrink' },
            

            // Einzelperson verteilt
            { text: ['Hey X, sexy Outfit! Verteile 2 Schlücke.'], playersNeeded: 1, multiStep: false, category: 'singleVerteil' },
            
            // Koffer packen
            { text: ['Ich packe meinen Koffer und nehme mit... X beginnt. Verlierer trinkt 2 Schlücke'], playersNeeded: 1, multiStep: false, category: 'koffer' },
            { text: ['Ich packe meine Arbeitstasche und nehme mit... X beginnt. Verlierer trinkt 2 Schlücke'], playersNeeded: 1, multiStep: false, category: 'koffer' },
            { text: ['Ich packe meinen Einkaufskorb und nehme mit... X beginnt. Verlierer trinkt 2 Schlücke'], playersNeeded: 1, multiStep: false, category: 'koffer' },
            { text: ['Ich packe meine Sporttasche und nehme mit... X beginnt. Verlierer trinkt 2 Schlücke'], playersNeeded: 1, multiStep: false, category: 'koffer' },

            // Abstimmungen
            { text: ['Abstimmung! Pizza oder Pasta? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Urlaub in den Bergen oder am Strand. Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Lieber blind oder taub sein? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Überlebenskampf gegen einen Wolf oder ein Wildschwein? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Mehr Freizeit oder mehr Gehalt? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Nachwuchs steht an! Junge oder Mädchen? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Vodka Bull oder Jacky Cola? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Für immer flüstern oder für immer schreien? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Niemals duschen oder niemals Zähneputzen? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Eine Zombie-Apokalypse überleben oder im Mittelalter leben? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Jeden Tag einen neuen Job haben oder für immer denselben langweiligen Job machen? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Immer Muskelkater haben oder immer einen leichten Sonnenbrand haben? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Immer hungrig sein oder immer müde sein? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Nie wieder eine Waschmaschine oder eine Spülmaschine nutzen dürfen? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Gedanken lesen können, aber nicht abschalten können oder fliegen können? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Unter Wasser atmen können oder im Dunkeln sehen können? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Nur in die Vergangenheit reisen können oder nur in die Zukunft reisen können? Die Minderheit trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'vote' },
            { text: ['Abstimmung! Wer ist die schönste Person? ...','Jede/s Hässlon ohne Stimme trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: true, category: 'vote' },

            // Einzelspieleraktivitäten
            { text: ['Kopfrechnen! X hat 5 Sekunden. Wie viel ist 12*17 ...', 'Lösung: 204. Liegt X richtig, dürfen 2 Schlücke verteilt werden, andernfalls selbst getrunken werden.'], playersNeeded: 1, multiStep: true, category: 'singlePlayerActivity' },
            { text: ['X erzähle einen Witz. Lacht oder schmunzelt niemand trinnkst du 2 Schlücke.'], playersNeeded: 1, multiStep: false, category: 'singlePlayerActivity' },
            { text: ['X macht einen Purtzelbaum vorwärts oder trinkt 2 Schlücke.'], playersNeeded: 1, multiStep: false, category: 'singlePlayerActivity' },
            { text: ['X macht einen Purtzelbaum rückwärts oder trinkt 2 Schlücke.'], playersNeeded: 1, multiStep: false, category: 'singlePlayerActivity' },
            { text: ['X macht 3 Sekunden einen Handstand oder trinkt 2 Schlücke.'], playersNeeded: 1, multiStep: false, category: 'singlePlayerActivity' },
            { text: ['X macht ein Rad oder trinkt 2 Schlücke.'], playersNeeded: 1, multiStep: false, category: 'singlePlayerActivity' },
            { text: ['X macht einen Trick oder trinkt 2 Schlücke.'], playersNeeded: 1, multiStep: false, category: 'singlePlayerActivity' },

            // Zwei-Spieler-Aktivitäten
            { text: ['Berufe-Pantomime: X stellt für 10 Sekunden einen Beruf pantomimisch dar, X rät. Scheitern sie, trinken beide 2 Schlücke.'], playersNeeded: 2, multiStep: false, category: 'doublePlayerActivity' },
            { text: ['X schlürft Sekt/Wein aus X Bauchnabel oder beide trinken 3 Schlücke.'], playersNeeded: 2, multiStep: false, category: 'doublePlayerActivity' },
            { text: ['X gib X 2€ oder beide trinken 3 Schlücke.'], playersNeeded: 2, multiStep: false, category: 'doublePlayerActivity' },
            { text: ['X und X. Spielt 3 Runden Schere-Stein-Papier! Der Verlierer trinkt 2 Schlücke.'], playersNeeded: 2, multiStep: false, category: 'doublePlayerActivity' },
            { text: ['X gib X einen Kuss auf die rechte Arschbacke oder trinkt beide 3 Schlücke.'], playersNeeded: 2, multiStep: false, category: 'doublePlayerActivity' },
            { text: ['X und X. Wer von euch ist größer? ...', 'Spielt keine Rolle, trinkt beide 2 Schlücke.'], playersNeeded: 2, multiStep: true, category: 'doublePlayerActivity' },
            { text: ['X summe für 30 Sekunden ein Lied, sodass X es errät. Bei Versagen trinken beide 2 Schlücke.'], playersNeeded: 2, multiStep: false, category: 'doublePlayerActivity' },
            { text: ['Tanzen auf Kommando: X leg einen Song auf. X muss 10 Sekunden improvisiert dazu tanzen oder beide trinken 4 Schlücke.'], playersNeeded: 2, multiStep: false, category: 'doublePlayerActivity' },
            
            
            // Drei-Spieler-Aktivitäten
            { text: ['X, X und X. Einigt euch, wer von euch 2 Schlücke trinkt. (2 Stimmen für die Mehrheit)'], playersNeeded: 3, multiStep: false, category: 'tripplePlayerActivity' },
            

            // All Player Activities
            { text: ['Jeder Spieler nennt einen deutschen Bundeskanzler (Doppelnennungen erlaub) ...', 'Scholz trinkt 2 Schlücke, Adenauer verteilt 2 Schlücke.'], playersNeeded: 2, multiStep: true, category: 'allPlayerActivity' },
            { text: ['X beginnt mit einer Zeile seines Lieblingssongs. Reihum muss das Lied weiter ergänzt werden. Wer versagt, trinkt 2 Schlücke.'], playersNeeded: 1, multiStep: false, category: 'allPlayerActivity' },
            { text: ['X startet. Gebt einen Löffel reihum nur mit dem Mund weiter. Wer versagt, trinkt 2 Schlücke.'], playersNeeded: 1, multiStep: false, category: 'allPlayerActivity' },
            { text: ['Satzbau: X startet und jeder fügt ein Wort zum Satz hinzu. Wer den Faden verliert oder den Satz beendet trinkt 2 Schlücke.'], playersNeeded: 1, multiStep: false, category: 'allPlayerActivity' },
            { text: ['Rhyme-Time. X startet mit einem Begriff und reihum müssen passende Reime gefunden werden. Kein Reim? 2 Schlücke!'], playersNeeded: 2, multiStep: false, category: 'allPlayerActivity' },
            { text: ['X wählt eine Kategorie. Nennt reihum passende Begriffe. Wem nichts mehr einfällt oder etwas doppelt nennt, trinkt 2 Schlücke.'], playersNeeded: 1, multiStep: false, category: 'allPlayerActivity' },
            { text: ['Schnapslotterie: X füllt Schnapsgläser heimlich mit Schnaps oder Wasser. Jeder wählt zufällig eines aus und trinkt.'], playersNeeded: 1, multiStep: false, category: 'allPlayerActivity' },
            { text: ['Wahrheit oder Lüge: X erzählt eine Wahrheit oder Lüge über sich. Jeder Spieler entscheidet für sich ob er die Aussage glaubt oder nicht. Wer falsch liegt, trinkt 2 Schlücke.'], playersNeeded: 1, multiStep: false, category: 'allPlayerActivity' },
            
            // Trinkregeln
            { text: ['Alle Spieler dürfen ab sofort nur noch mit dem Nachnamen angesprochen werden. Bei Verstoß 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'drinkRules' },
            { text: ['X! Du sprichst ab sofort Englisch. Bei jedem Verstoß trinkst du einen Schluck.'], playersNeeded: 1, multiStep: false, category: 'drinkRules' },
            { text: ['Wer ab sofort X in die Augen schaut trinkt 2 Schlücke.'], playersNeeded: 1, multiStep: false, category: 'drinkRules' },
            { text: ['Die Wörter Wein, Bier und Sekt sind ab sofort verboten. Bei Verstoß 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'drinkRules' },
            { text: ['X überlegt sich eine Trinkregel. Wer diese vergisst, trinkt die gleiche Anzahl an Schlücken nochmal.'], playersNeeded: 1, multiStep: false, category: 'drinkRules' },
            { text: ['Wer ab sofort ein Schimpfwort oder eine Beleidgung benutzt, trinkt 2 Schlücke.'], playersNeeded: 0, multiStep: false, category: 'drinkRules' },
            
        ];

        // Funktion, um Spieler zufällig auszuwählen
        function getRandomPlayers(count) {
            const shuffled = players.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }


        // Helper function to enforce category constraints while shuffling
        function shuffleWithCategoryConstraint(activities) {
            let shuffled = [];
            let lastCategory = null;

            while (activities.length > 0) {
                const index = activities.findIndex(activity => activity.category !== lastCategory);
                if (index === -1) break; // This shouldn't happen with proper inputs.

                const [selected] = activities.splice(index, 1);
                shuffled.push(selected);
                lastCategory = selected.category;
            }

            // If there are remaining activities, append them at the end (edge cases)
            shuffled.push(...activities);

            return shuffled;
        }

        function ensureCategoryDistribution(activities, categoryRequirements) {
            const categorizedActivities = {};
            let result = [];

            // Aktivitäten nach Kategorien sortieren
            activities.forEach(activity => {
                if (!categorizedActivities[activity.category]) {
                    categorizedActivities[activity.category] = [];
                }
                categorizedActivities[activity.category].push(activity);
            });

            // Aktivitäten gemäß Anforderungen hinzufügen
            for (const [category, count] of Object.entries(categoryRequirements)) {
                if (categorizedActivities[category]) {
                    const selected = categorizedActivities[category].sort(() => 0.5 - Math.random()).slice(0, count);
                    result.push(...selected);
                }
            }

            // Restliche Aktivitäten auffüllen
            const remainingActivities = activities.filter(activity => !result.includes(activity));
            const remainingCount = 30 - result.length;
            result.push(...remainingActivities.sort(() => 0.5 - Math.random()).slice(0, remainingCount));

            // Sicherstellen, dass keine zwei Aktivitäten derselben Kategorie direkt aufeinander folgen
            return shuffleWithCategoryConstraint(result);
        }

        // Aktivitäten filtern, wenn Spieleranzahl 2 ist
        let filteredActivities = activities;
        if (players.length === 2) {
            filteredActivities = activities.filter(activity => activity.playersNeeded < 3);
        }

        // Kategorien und deren Mindestanzahl definieren
        const categoryRequirements = {
            'koffer': 2,
            'allDrink' : 2,
            'allVerteil' : 2,
            'singleDrink' : 2,
            'singleVerteil' : 2,
            'vote' : 2,
            'singlePlayerActivity' : 2,
            'doublePlayerActivity' : 2,
            'tripplePlayerActivity' : 2,
            'allPlayerActivity' : 2,
            'drinkRegel' : 2,
        };
        

        // Aktivitäten zufällig mischen und abarbeiten
        let shuffledActivities = ensureCategoryDistribution(filteredActivities, categoryRequirements);
        let currentActivityIndex = 0;
        let currentStep = 0;

        // Platzhalter "X" durch Spielernamen ersetzen
        function replacePlaceholders(text, selectedPlayers) {
            let result = text;
            selectedPlayers.forEach(player => {
                result = result.replace('X', player);
            });
            return result;
        }

        // Variable to store players for multi-step activities
        let multiStepPlayers = [];

        // Nächste Aktivität anzeigen
        function showNextActivity() {
            const activityContainer = document.getElementById('activityContainer');
            const nextButton = document.getElementById('nextButton');

            if (currentActivityIndex >= shuffledActivities.length || currentActivityIndex == 10) {
                activityContainer.innerHTML = '<h3>Das Spiel ist vorbei! Prost!</h3>';
                nextButton.textContent = "Neues Spiel starten";
                nextButton.addEventListener('click', () => {
                    window.location.href = `game.html?${players.map((player, index) => `player${index}=${player}`).join('&')}`;
                });
                return;
            }

            const activity = shuffledActivities[currentActivityIndex];
            const selectedPlayers = getRandomPlayers(activity.playersNeeded);

            if (currentStep === 0) {
                multiStepPlayers = getRandomPlayers(activity.playersNeeded);
                const activityText = replacePlaceholders(activity.text[0], multiStepPlayers);
                activityContainer.innerHTML = `<h3>${activityText}</h3>`;

                if (activity.multiStep) {
                    currentStep = 1;
                } else {
                    currentActivityIndex++;
                }
            } else {
                const activityText = replacePlaceholders(activity.text[1], multiStepPlayers);
                activityContainer.innerHTML = `<h3>${activityText}</h3>`;
                currentActivityIndex++;
                currentStep = 0;
            }
        }

        // Initiale Aktivität anzeigen
        document.getElementById('nextButton').addEventListener('click', showNextActivity);
        showNextActivity();

        // Bestätigung für "Zurück zum Start"
        document.getElementById('backButton').addEventListener('click', function(event) {
            event.preventDefault();
            const confirmBack = confirm("Möchtest du wirklich zum Start zurückkehren? Das Spiel wird beendet.");
            if (confirmBack) {
                window.location.href = "index.html";
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
